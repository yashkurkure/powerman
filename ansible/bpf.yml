- name: Install bpf
  become: true
  hosts: all
  tasks:

    - name: Update & Install deps
      ansible.builtin.apt:
        update_cache: yes
        pkg:
        - zip
        - bison
        - build-essential
        - cmake
        - flex
        - git
        - libedit-dev
        - libllvm12
        - llvm-12-dev 
        - libclang-12-dev
        - python
        - zlib1g-dev
        - libelf-dev
        - libfl-dev
        - python3-setuptools
        - liblzma-dev
        - arping
        - iperf
        - netperf
      
    - name: Make and Install
      shell: |
        cd /local
        git clone https://github.com/iovisor/bcc.git
        mkdir bcc/build; cd bcc/build
        cmake ..
        make
        sudo make install
        cmake -DPYTHON_CMD=python3 .. # build python3 binding
        pushd src/python/
        make
        sudo make install
        popd